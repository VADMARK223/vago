import{d as e,n as t}from"./index-BvNZr30m.js";var n=e();function r(){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(`p`,{children:`Это механизм, который решает:`}),(0,n.jsxs)(`ol`,{children:[(0,n.jsx)(`li`,{children:`какой код выполнить сейчас`}),(0,n.jsx)(`li`,{children:`какой — позже`}),(0,n.jsx)(`li`,{children:`в каком порядке выполнять “позже”`})]}),(0,n.jsxs)(`p`,{children:[`JS в браузере и Node.js в основном `,(0,n.jsx)(`b`,{children:`однопоточный`}),` для твоего кода: в один момент времени выполняется только одна штука. Асинхронность достигается очередями и циклом обработки.`]}),(0,n.jsx)(`hr`,{}),(0,n.jsx)(`h2`,{children:`3 главные части`}),(0,n.jsx)(`h3`,{children:`1) Call Stack (стек вызовов)`}),(0,n.jsx)(`p`,{children:`Туда попадают обычные функции. Пока стек не пуст — JS занят.`}),(0,n.jsx)(`h3`,{children:`2) Web APIs / Background (в браузере) / libuv (в Node)`}),(0,n.jsx)(`p`,{children:`Это “помощники”, которые умеют ждать:`}),(0,n.jsxs)(`ul`,{children:[(0,n.jsxs)(`li`,{children:[`таймеры (`,(0,n.jsx)(`code`,{children:`setTimeout`}),`)`]}),(0,n.jsxs)(`li`,{children:[`запросы (`,(0,n.jsx)(`code`,{children:`fetch`}),`)`]}),(0,n.jsxs)(`li`,{children:[`события (`,(0,n.jsx)(`code`,{children:`click`}),`)`]}),(0,n.jsx)(`li`,{children:`чтение файлов (Node)`})]}),(0,n.jsx)(`p`,{children:`Они не выполняют твой JS-код, они просто ждут и потом кладут callback в очередь.`}),(0,n.jsx)(`h3`,{children:`3) Очереди задач`}),(0,n.jsx)(`h4`,{children:`✅ Microtask queue (микрозадачи)`}),(0,n.jsx)(`p`,{children:`Туда попадают:`}),(0,n.jsxs)(`ul`,{children:[(0,n.jsx)(`li`,{children:(0,n.jsx)(`code`,{children:`Promise.then/catch/finally`})}),(0,n.jsx)(`li`,{children:(0,n.jsx)(`code`,{children:`queueMicrotask`})}),(0,n.jsxs)(`li`,{children:[`(ещё: `,(0,n.jsx)(`code`,{children:`MutationObserver`}),` в браузере)`]})]}),(0,n.jsxs)(`p`,{children:[(0,n.jsx)(`code`,{children:`Особенность`}),`: микрозадачи выполняются `,(0,n.jsx)(`b`,{children:`сразу после синхронного кода`}),`, и`,` `,(0,n.jsx)(`b`,{children:`все подряд`}),`, пока очередь не станет пустой.`]}),(0,n.jsx)(`h4`,{children:`✅ Macrotask queue (макрозадачи)`}),(0,n.jsx)(`p`,{children:`Туда попадают:`}),(0,n.jsxs)(`ul`,{children:[(0,n.jsxs)(`li`,{children:[(0,n.jsx)(`code`,{children:`setTimeout`}),` / `,(0,n.jsx)(`code`,{children:`setInterval`})]}),(0,n.jsxs)(`li`,{children:[`обработчики событий (`,(0,n.jsx)(`code`,{children:`click`}),`, `,(0,n.jsx)(`code`,{children:`message`}),`)`]}),(0,n.jsx)(`li`,{children:`некоторые I/O задачи`})]}),(0,n.jsxs)(`p`,{children:[(0,n.jsx)(`b`,{children:`Особенность`}),`: макрозадачи выполняются `,(0,n.jsx)(`code`,{children:`по одной за “тик”`}),` цикла.`]}),(0,n.jsx)(`hr`,{}),(0,n.jsx)(`h2`,{children:`Главный порядок`}),(0,n.jsx)(`p`,{children:`Каждый “тик” event loop выглядит примерно так:`}),(0,n.jsxs)(`ol`,{children:[(0,n.jsxs)(`li`,{children:[`Выполни `,(0,n.jsx)(`b`,{children:`весь синхронный код`}),` (пока стек не пуст)`]}),(0,n.jsxs)(`li`,{children:[`Выполни `,(0,n.jsx)(`b`,{children:`ВСЕ microtasks`}),` (пока очередь не пустая)`]}),(0,n.jsxs)(`li`,{children:[`Выполни `,(0,n.jsx)(`b`,{children:`ОДНУ macrotask`})]}),(0,n.jsx)(`li`,{children:`(браузер может сделать рендер)`}),(0,n.jsx)(`li`,{children:`повторить`})]}),(0,n.jsx)(`p`,{}),(0,n.jsx)(`p`,{children:(0,n.jsx)(`b`,{children:`Sync → Microtasks → Macrotask → (Render) → Sync → ...`})}),(0,n.jsx)(`hr`,{}),(0,n.jsx)(`h2`,{id:`example`,children:`Пример`}),(0,n.jsx)(t,{code:`console.log('A');

setTimeout(() => console.log('B'), 0);

Promise.resolve().then(() => console.log('C'));

console.log('D');`}),(0,n.jsxs)(`ol`,{children:[(0,n.jsx)(`li`,{children:`sync: A, D`}),(0,n.jsx)(`li`,{children:`microtasks: C`}),(0,n.jsx)(`li`,{children:`macrotask: B`})]}),(0,n.jsxs)(`p`,{children:[`Итог: `,(0,n.jsx)(`b`,{children:`A D C B`})]})]})}export{r as default};