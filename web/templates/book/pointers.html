{{ define "book.pointers" }}
<h1>–£–∫–∞–∑–∞—Ç–µ–ª–∏</h1>
<h2>1. –ß—Ç–æ —Ç–∞–∫–æ–µ —É–∫–∞–∑–∞—Ç–µ–ª—å –≤ Go</h2>
<p><b>–£–∫–∞–∑–∞—Ç–µ–ª—å</b> ‚Äî —ç—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è, –∫–æ—Ç–æ—Ä–∞—è —Ö—Ä–∞–Ω–∏—Ç <b>–∞–¥—Ä–µ—Å –≤ –ø–∞–º—è—Ç–∏</b> –¥—Ä—É–≥–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π.</p>
<pre><code class="language-go">x := 10
p := &x</code></pre>
<ul>
    <li><code>x</code> - –∑–Ω–∞—á–µ–Ω–∏–µ <code>10</code></li>
    <li><code>&x</code> - –∞–¥—Ä–µ—Å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π <code>x</code></li>
    <li><code>p</code> - —É–∫–∞–∑–∞—Ç–µ–ª—å —Ç–∏–ø–∞ <code>*int</code></li>
</ul>
<pre><code class="language-go">fmt.Println(p)   // –Ω–∞–ø—Ä–∏–º–µ—Ä: 0xc0000120a8
fmt.Println(*p)  // 10</code></pre>
<h3>–û–ø–µ—Ä–∞—Ç–æ—Ä—ã</h3>
<table>
    <thead>
    <tr>
        <th>–û–ø–µ—Ä–∞—Ç–æ—Ä—ã</th>
        <th>–ó–Ω–∞—á–µ–Ω–∏—è</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td><code>&x</code></td>
        <td>–≤–∑—è—Ç—å –∞–¥—Ä–µ—Å</td>
    </tr>
    <tr>
        <td><code>*p</code></td>
        <td>—Ä–∞–∑—ã–º–µ–Ω–æ–≤–∞—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª—å</td>
    </tr>
    </tbody>
</table>
<div class="panel">
    –ò—Å–ø–æ–ª—å–∑—É–π —É–∫–∞–∑–∞—Ç–µ–ª—å, –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç:
    <ul>
        <li>–¥–æ–ª–∂–µ–Ω –∏–∑–º–µ–Ω—è—Ç—å—Å—è</li>
        <li>–±–æ–ª—å—à–æ–π</li>
        <li>–∏–º–µ–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ</li>
        <li>–º–æ–∂–µ—Ç –±—ã—Ç—å <code>nil</code></li>
    </ul>
</div>
<blockquote class="note">
    ‚ùå –í Go –Ω–µ—Ç ¬´–ø–µ—Ä–µ–¥–∞—á–∏ –ø–æ —Å—Å—ã–ª–∫–µ¬ª<br>
    ‚úÖ –í Go –µ—Å—Ç—å <b>–ø–µ—Ä–µ–¥–∞—á–∞ —É–∫–∞–∑–∞—Ç–µ–ª—è –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é</b>
</blockquote>

<h2>2. –¢–∏–ø—ã —É–∫–∞–∑–∞—Ç–µ–ª–µ–π</h2>
<pre><code class="language-go">var p *int</code></pre>
<ul>
    <li><code>*int</code> ‚Äî —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ <code>int</code></li>
    <li><code>*User</code> ‚Äî —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É <code>User</code></li>
    <li><code>**int</code> ‚Äî —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —É–∫–∞–∑–∞—Ç–µ–ª—å (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–¥–∫–æ)</li>
</ul>
<p>‚ö†Ô∏è –í Go <b>–Ω–µ—Ç pointer arithmetic</b>, –∫–∞–∫ –≤ C:</p>
<pre><code class="language-go">p++ // ‚ùå –∑–∞–ø—Ä–µ—â–µ–Ω–æ</code></pre>

<h2>3. nil-—É–∫–∞–∑–∞—Ç–µ–ª—å</h2>
<p>–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —É–∫–∞–∑–∞—Ç–µ–ª—å —Ä–∞–≤–µ–Ω <code>nil</code>.</p>
<pre><code class="language-go">var p *int
fmt.Println(p == nil) // true
</code></pre>
<p>–†–∞–∑—ã–º–µ–Ω–æ–≤—ã–≤–∞—Ç—å <code>nil</code> –Ω–µ–ª—å–∑—è:</p>
<pre><code class="language-go">*p = 10 // panic: nil pointer dereference
</code></pre>
<p>‚úÖ –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π:</p>
<pre><code class="language-go">if p != nil {
    fmt.Println(*p)
}
</code></pre>

<h2>4. –ü–µ—Ä–µ–¥–∞—á–∞ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é vs –ø–æ —É–∫–∞–∑–∞—Ç–µ–ª—é</h2>
<p>‚ùå –ü–µ—Ä–µ–¥–∞—á–∞ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é</p>
<pre><code class="language-go">func inc(x int) {
    x++
}
a := 10
inc(a)
fmt.Println(a) // 10</code></pre>
<p>‚úÖ –ü–µ—Ä–µ–¥–∞—á–∞ –ø–æ —É–∫–∞–∑–∞—Ç–µ–ª—é</p>
<pre><code class="language-go">func inc(x *int) {
    (*x)++
}
a := 10
inc(&a)
fmt.Println(a) // 11</code></pre>
<p><b>üìå Go –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–¥–∞—ë—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é</b>, –Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º –º–æ–∂–µ—Ç –±—ã—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª—å.</p>

<h2>5. –£–∫–∞–∑–∞—Ç–µ–ª–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã</h2>
<p>–ü–µ—Ä–µ–¥–∞—á–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é (–∫–æ–ø–∏—è)</p>
<pre><code class="language-go">type User struct {
    Name string
}

func rename(u User) {
    u.Name = "Bob"
}</code></pre>
<p>–ü–µ—Ä–µ–¥–∞—á–∞ –ø–æ —É–∫–∞–∑–∞—Ç–µ–ª—é (–∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞)</p>
<pre><code class="language-go">func rename(u *User) {
    // Go –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑—ã–º–µ–Ω–æ–≤—ã–≤–∞–µ—Ç
    u.Name = "Bob" // (*u).Name ‚Äî –º–æ–∂–Ω–æ –±–µ–∑ —Å–∫–æ–±–æ–∫
}</code></pre>

<h2>6. –ú–µ—Ç–æ–¥—ã —Å —É–∫–∞–∑–∞—Ç–µ–ª—è–º–∏</h2>
<pre><code class="language-go">type Counter struct {
    value int
}

func (c *Counter) Inc() {
    c.value++
}</code></pre>
<p>–ü–æ—á–µ–º—É <code>*Counter</code>?</p>
<ul>
    <li>–º–µ—Ç–æ–¥ <b>–∏–∑–º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ</b></li>
    <li>–Ω–µ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞</li>
    <li>–µ–¥–∏–Ω—ã–π method set</li>
</ul>
<pre><code class="language-go">c := Counter{}
c.Inc() // Go —Å–∞–º –≤–æ–∑—å–º—ë—Ç &c</code></pre>

<h2>7. –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª–∏</h2>
<h3>‚úÖ 1. –ù—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –æ–±—ä–µ–∫—Ç</h3>
<pre><code class="language-go">func Update(u *User) {}</code></pre>
<h3>‚úÖ 2. –ë–æ–ª—å—à–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)</h3>
<pre><code class="language-go">type Big struct {
    Data [1024]int
}</code></pre>
<p>–ü–µ—Ä–µ–¥–∞—á–∞ <code>Big</code> ‚Üí –∫–æ–ø–∏—è</p>
<p>–ü–µ—Ä–µ–¥–∞—á–∞ <code>*Big</code> ‚Üí –¥–µ—à–µ–≤–æ</p>
<h3>‚úÖ 3. –û–±—â–∏–π –¥–æ—Å—Ç—É–ø –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—é</h3>
<pre><code class="language-go">type Service struct {
    repo *Repo
}</code></pre>
<h3>‚úÖ 4. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å nil –∫–∞–∫ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</h3>
<pre><code class="language-go">var user *User = nil</code></pre>

<h2>8. –£–∫–∞–∑–∞—Ç–µ–ª–∏ –∏ escape analysis</h2>
<pre><code class="language-go">func create() *User {
    u := User{Name: "Bob"}
    return &u
}</code></pre>
<p>‚ö†Ô∏è u –±—É–¥–µ—Ç <b>–≤—ã–¥–µ–ª–µ–Ω –≤ heap</b>, –∞ –Ω–µ –≤ stack.</p>
<p>Go —Å–∞–º —Ä–µ—à–∞–µ—Ç:</p>
<ul>
    <li>stack ‚Äî –±—ã—Å—Ç—Ä–æ</li>
    <li>heap ‚Äî –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç ‚Äú—É–±–µ–≥–∞–µ—Ç‚Äù –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏</li>
</ul>
<p>–ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:</p>
<pre><code class="language-go">go build -gcflags="-m"</code></pre>

<h2>9. –£–∫–∞–∑–∞—Ç–µ–ª–∏ –∏ new</h2>
<pre><code class="language-go">p := new(int)
*p = 10
// –≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ:
x := 10
p := &x
// –î–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä:
u := new(User)
u.Name = "Alice"
// –ù–æ —á–∞—â–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç:
u := &User{Name: "Alice"}</code></pre>

{{ end }}