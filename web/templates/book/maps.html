{{ define "book.maps" }}
<h1>–ö–∞—Ä—Ç—ã</h1>
<p><code>map</code> –≤ Go ‚Äî —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞—Ä <b>–∫–ª—é—á ‚Üí –∑–Ω–∞—á–µ–Ω–∏–µ</b> —Å –±—ã—Å—Ç—Ä—ã–º –¥–æ—Å—Ç—É–ø–æ–º –ø–æ –∫–ª—é—á—É.</p>
<h2>–¢–∏–ø—ã –∫–ª—é—á–µ–π</h2>
<p>–ö–ª—é—á –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å <b>—Å—Ä–∞–≤–Ω–∏–º—ã–º</b> (<code>comparable</code>):</p>
<p>‚úÖ –ú–æ–∂–Ω–æ:</p>
<ul>
    <li>string</li>
    <li>int, float64</li>
    <li>bool</li>
    <li>struct (–µ—Å–ª–∏ –≤—Å–µ –ø–æ–ª—è comparable)</li>
    <li>array</li>
</ul>
<p>‚ùå –ù–µ–ª—å–∑—è:</p>
<ul>
    <li>slice</li>
    <li>map</li>
    <li>func</li>
</ul>
<hr/>
<p>‚ö†Ô∏è Map –Ω–µ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–µ–Ω</p>
<pre><code class="language-go">go func() { m["a"] = 1 }()
go func() { m["b"] = 2 }() // race</code></pre>
<p>‚ö†Ô∏è –ù–µ–ª—å–∑—è –ø–∏—Å–∞—Ç—å –≤ nil-map</p>
<pre><code class="language-go">var m map[string]int
m["a"] = 1 // panic
fmt.Println(m["a"]) // 0 –ù–æ —á–∏—Ç–∞—Ç—å –º–æ–∂–Ω–æ
</code></pre>

<h2>Map ‚Äî —Å—Å—ã–ª–æ—á–Ω—ã–π —Ç–∏–ø</h2>
<pre><code class="language-go">func change(m map[string]int) {
    m["a"] = 10
}

func main() {
    m := map[string]int{"a": 1}
    change(m)
    fmt.Println(m["a"]) // 10
}</code></pre>
<p>‚ùó Map –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è <b>–ø–æ —Å—Å—ã–ª–∫–µ –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö</b>, –∫–æ–ø–∏–∏ –Ω–µ—Ç.</p>

<h2>–ò—Ç–µ—Ä–∞—Ü–∏—è –ø–æ map</h2>
<h3>–ü–æ—Ä—è–¥–æ–∫</h3>
<pre><code class="language-go">for k, v := range m {
    fmt.Println(k, v)
}</code></pre>
<p>‚ö†Ô∏è <b>–ü–æ—Ä—è–¥–æ–∫ –≤—Å–µ–≥–¥–∞ —Å–ª—É—á–∞–π–Ω—ã–π</b></p>
<p>–ù–µ–ª—å–∑—è –Ω–∞ –Ω–µ–≥–æ –ø–æ–ª–∞–≥–∞—Ç—å—Å—è (–¥–∞–∂–µ –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏).</p>
<p>–ï—Å–ª–∏ –Ω—É–∂–µ–Ω –ø–æ—Ä—è–¥–æ–∫:</p>
<pre><code class="language-go">keys := make([]string, 0, len(m))
for k := range m {
    keys = append(keys, k)
}
sort.Strings(keys)

for _, k := range keys {
    fmt.Println(k, m[k])
}</code></pre>

<h3>–£–¥–∞–ª–µ–Ω–∏–µ</h3>
<p>–í <b>–æ–¥–Ω–æ–π –≥–æ—Ä—É—Ç–∏–Ω–µ</b> —É–¥–∞–ª—è—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –≤–æ –≤—Ä–µ–º—è <code>range</code> –º–æ–∂–Ω–æ. –≠—Ç–æ <b>–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ</b> –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ.</p>
<pre><code class="language-go">m := map[string]int{
	"a": 1,
	"b": 2,
	"c": 3,
}

for k, v := range m {
	if v%2 == 0 {
		delete(m, k) // ‚úÖ –±–µ–∑–æ–ø–∞—Å–Ω–æ
	}
}

fmt.Println(m)
</code></pre>
<p>‚ùå –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ ‚Äî –ù–ï–õ–¨–ó–Ø. –ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –≥–æ—Ä—É—Ç–∏–Ω–∞ –ø–∏—à–µ—Ç –≤ map, –∞ –¥—Ä—É–≥–∞—è:</p>
<ul>
    <li>—á–∏—Ç–∞–µ—Ç</li>
    <li>–∏–ª–∏ —Ç–æ–∂–µ –ø–∏—à–µ—Ç</li>
</ul>
<p>‚Üí panic: concurrent map iteration and map write</p>
<pre><code class="language-go">for k := range m {
	go func() {
		delete(m, k) // ‚ùå –ø–æ—á—Ç–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π panic
	}()
}
</code></pre>
<p>‚úî –†–µ—à–µ–Ω–∏–µ: <code>Mutex</code>, <code>sync.Map</code> –∏–ª–∏ –∫–∞–Ω–∞–ª.</p>

<h3>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤–æ –≤—Ä–µ–º—è range</h3>
<pre><code class="language-go">for k, v := range m {
	if k == "a" {
		m["new"] = 100 // ‚úÖ –Ω–µ panic
	}
}
</code></pre>
<p>‚ö†Ô∏è –ù–û:</p>
<ul>
    <li>–Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç <b>–º–æ–∂–µ—Ç –±—ã—Ç—å</b>, –∞ –º–æ–∂–µ—Ç <b>–Ω–µ –±—ã—Ç—å</b> –ø—Ä–æ–π–¥–µ–Ω –≤ —ç—Ç–æ–º –∂–µ <code>range</code></li>
    <li>–ø–æ–≤–µ–¥–µ–Ω–∏–µ <b>–Ω–µ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–æ</b></li>
</ul>
<p>üëâ –ü–æ—ç—Ç–æ–º—É:</p>
<ul>
    <li><b>panic –Ω–µ –±—É–¥–µ—Ç</b></li>
    <li>–Ω–æ <b>–ª–æ–≥–∏–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–æ–º–∞–Ω–∞</b></li>
</ul>
<h3>–ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è Go</h3>
<table>
    <thead>
    <tr>
        <th>–û–ø–µ—Ä–∞—Ü–∏—è</th>
        <th>–†–∞–∑—Ä–µ—à–µ–Ω–æ</th>
        <th>–ì–∞—Ä–∞–Ω—Ç–∏–∏</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td><code>delete(m, k)</code></td>
        <td>‚úÖ</td>
        <td>—ç–ª–µ–º–µ–Ω—Ç —Ç–æ—á–Ω–æ –∏—Å—á–µ–∑–Ω–µ—Ç</td>
    </tr>
    <tr>
        <td><code>m[k] = v</code> (–Ω–æ–≤—ã–π –∫–ª—é—á)</td>
        <td>‚úÖ</td>
        <td>–º–æ–∂–µ—Ç –±—ã—Ç—å –∏–ª–∏ –Ω–µ –±—ã—Ç—å –≤ –∏—Ç–µ—Ä–∞—Ü–∏–∏</td>
    </tr>
    <tr>
        <td><code>m[k] = v</code> (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–ª—é—á)</td>
        <td>‚úÖ</td>
        <td>–∑–Ω–∞—á–µ–Ω–∏–µ –æ–±–Ω–æ–≤–∏—Ç—Å—è</td>
    </tr>
    <tr>
        <td>–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å</td>
        <td>‚ùå</td>
        <td>panic</td>
    </tr>
    </tbody>
</table>


<h2>–°–æ–∑–¥–∞–Ω–∏–µ</h2>
<h3>–ß–µ—Ä–µ–∑ –ª–∏—Ç–µ—Ä–∞–ª</h3>
<pre><code class="language-go">m := map[string]int{
    "a": 1,
    "b": 2,
}</code></pre>
<h3>–ß–µ—Ä–µ–∑ make</h3>
<pre><code class="language-go">m := make(map[string]int)
m["a"] = 1</code></pre>

<h2>–î–æ—Å—Ç—É–ø –∫ —ç–ª–µ–º–µ–Ω—Ç—É</h2>
<pre><code class="language-go">v, ok := m["a"]
if ok { // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–∂–Ω–∞!
    fmt.Println("–ï—Å—Ç—å:", v)
}</code></pre>

<h2>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</h2>
<pre><code class="language-go">m["c"] = 3      // –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ
m["a"] = 100    // –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</code></pre>

<h2>–£–¥–∞–ª–µ–Ω–∏–µ</h2>
<pre><code class="language-go">delete(m, "a")</code></pre>
<ul>
    <li>–±–µ–∑–æ–ø–∞—Å–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å, –¥–∞–∂–µ –µ—Å–ª–∏ –∫–ª—é—á–∞ –Ω–µ—Ç</li>
    <li>panic –Ω–µ –±—É–¥–µ—Ç</li>
</ul>

{{ end }}