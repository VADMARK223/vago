{{ define "book.errors" }}
<h1>–û—à–∏–±–∫–∏ –∏ –ø–∞–Ω–∏–∫–∏</h1>
<p>–í Go –æ—à–∏–±–∫–∞ ‚Äî —ç—Ç–æ –æ–±—ã—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∞ –Ω–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.</p>
<pre><code class="language-go">type error interface {
    Error() string
}</code></pre>
<p>üëâ –û—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è —è–≤–Ω–æ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ç–∞–º, –≥–¥–µ –≤–æ–∑–Ω–∏–∫–ª–∏.</p>
<pre><code class="language-go">data, err := os.ReadFile("config.yaml")
if err != nil {
    return err
}</code></pre>
<h2>–ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏</h2>
<p>‚ùå –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É:</p>
<pre><code class="language-go">data, _ := os.ReadFile("file")</code></pre>
<p>‚ùå –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ</p>
<p>‚ùå –¢–µ—Ä—è—Ç—å –æ—à–∏–±–∫—É –±–µ–∑ %w</p>
<p>‚ùå –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ ==</p>
<p>‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å panic –≤–º–µ—Å—Ç–æ error</p>
<h2>–ò–¥–∏–æ–º–∞—Ç–∏—á–Ω—ã–π –ø—Ä–∏–º–µ—Ä</h2>
<pre><code class="language-go">var (
    ErrTooSmall = errors.New("–∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–æ–µ")
    ErrTooLarge = errors.New("–∑–Ω–∞—á–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ")
)

func main() {
    err := test(7)

    switch {
    case errors.Is(err, ErrTooLarge):
        fmt.Println("–ß–∏—Å—Ç–æ –±–æ–ª—å—à–æ–µ")
    case errors.Is(err, ErrTooSmall):
        fmt.Println("–ß–∏—Å—Ç–æ –º–∞–ª–µ–Ω—å–∫–æ–µ")
    case err != nil:
        fmt.Println("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞:", err)
    }
}

func test(n int) error {
    if n < 5 {
        return fmt.Errorf("test(): —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –º–µ–Ω—å—à–µ –ø–æ—Ä–æ–≥–∞: %w", ErrTooSmall)
    }
    return fmt.Errorf("test(): —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –±–æ–ª—å—à–µ –ø–æ—Ä–æ–≥–∞: %w", ErrTooLarge)
}</code></pre>

<h2>–°–æ–∑–¥–∞–Ω–∏–µ</h2>
<h3>errors.New ‚Äî –ø—Ä–æ—Å—Ç–∞—è –æ—à–∏–±–∫–∞</h3>
<pre><code class="language-go">var ErrNotFound = errors.New("not found")</code></pre>

<h3>fmt.Errorf ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
<pre><code class="language-go">return fmt.Errorf("open file %s: %v", path, err)
</code></pre>
<p>‚ö†Ô∏è –ù–æ —Ç–∞–∫ —Ç–µ—Ä—è–µ—Ç—Å—è —Ç–∏–ø –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å <code>%w</code>.</p>

<h2>Wrapping –æ—à–∏–±–æ–∫ (%w) ‚Äî –ö–õ–Æ–ß–ï–í–û üîë</h2>
<pre><code class="language-go">return fmt.Errorf("load config: %w", err)</code></pre>
<p>–¢–µ–ø–µ—Ä—å:</p>
<ul>
    <li>—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞</li>
    <li>–º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É —á–µ—Ä–µ–∑ <code>errors.Is</code></li>
</ul>
<pre><code class="language-go">if errors.Is(err, os.ErrNotExist) {
    // —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω
}</code></pre>
<blockquote class="note">–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π <code>%w</code>, –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ –∏–¥—ë—Ç –¥–∞–ª—å—à–µ –≤–≤–µ—Ä—Ö –ø–æ —Å—Ç–µ–∫—É</blockquote>

<h2>errors.Is –∏ errors.As</h2>
<h3>errors.Is ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏—á–∏–Ω—ã</h3>
<pre><code class="language-go">if errors.Is(err, sql.ErrNoRows) {
    return ErrNotFound
}</code></pre>
<p>–†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Ä–æ–≤–Ω–µ–π wrapping.</p>
<h3>errors.As ‚Äî –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–∏–ø–∞</h3>
<pre><code class="language-go">var pathErr *fs.PathError
if errors.As(err, &pathErr) {
    log.Println("–û—à–∏–±–∫–∞ –ø—É—Ç–∏:", pathErr.Path)
}</code></pre>
<p>–ò—Å–ø–æ–ª—å–∑—É–π, –∫–æ–≥–¥–∞ –≤–∞–∂–Ω—ã –¥–µ—Ç–∞–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—à–∏–±–∫–∏.</p>

<hr/>
<h2>Panic</h2>
<p><code>panic</code> ‚Äî —ç—Ç–æ <b>–∞–≤–∞—Ä–∏–π–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</b>.</p>
<pre><code class="language-go">panic("something went wrong")</code></pre>
<p>–ü–æ—Å–ª–µ <code>panic</code>:</p>
<ol>
    <li>–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ <b>–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è</b></li>
    <li>–≤—ã–∑—ã–≤–∞—é—Ç—Å—è –≤—Å–µ <code>defer</code> <b>–≤ —Ç–µ–∫—É—â–µ–π –≥–æ—Ä—É—Ç–∏–Ω–µ</b></li>
    <li>–ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç <b>—Ä–∞—Å–∫—Ä—É—Ç–∫–∞ —Å—Ç–µ–∫–∞</b></li>
    <li>–µ—Å–ª–∏ <code>panic</code> –Ω–µ –ø–æ–π–º–∞–ª–∏ ‚Üí <b>–ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø–∞–¥–∞–µ—Ç</b></li>
</ol>
<p>üëâ –ü—Ä–∞–≤–∏–ª–æ:</p>
<blockquote class="note">
    –í—Å—ë, —á—Ç–æ –º–æ–∂–µ—Ç —Å–ª—É—á–∏—Ç—å—Å—è –≤ —Ä–∞–Ω—Ç–∞–π–º–µ ‚Äî <code>error</code>,<br>
    –≤—Å—ë, —á—Ç–æ <i>–Ω–µ –¥–æ–ª–∂–Ω–æ —Å–ª—É—á–∞—Ç—å—Å—è –≤–æ–æ–±—â–µ</i> ‚Äî <code>panic</code>.
</blockquote>
<h3>Recover - –∫–∞–∫ –ø–æ–π–º–∞—Ç—å panic</h3>
<p><code>recover()</code> <b>—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ defer.</b></p>
<pre><code class="language-go">func safe() {
    defer func() {
        if r := recover(); r != nil {
            fmt.Println("Recovered:", r)
        }
    }()

    panic("boom")
}</code></pre>
<p>–ë–µ–∑ <code>defer</code> ‚Äî <b>–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</b>.</p>
<h3>panic –≤ –≥–æ—Ä—É—Ç–∏–Ω–∞—Ö ‚ö†Ô∏è</h3>
<p>‚ùó panic <b>—É–±–∏–≤–∞–µ—Ç –≤—Å—é –ø—Ä–æ–≥—Ä–∞–º–º—É</b>, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –≥–æ—Ä—É—Ç–∏–Ω—É.</p>
<b>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –≥–æ—Ä—É—Ç–∏–Ω</b>
<pre><code class="language-go">go func() {
    defer func() {
        if r := recover(); r != nil {
            log.Println("goroutine panic:", r)
        }
    }()

    doWork()
}()</code></pre>

<h2>Panic vs error (–≤–∞–∂–Ω–æ!)</h2>
<p>‚ùå panic ‚Äî –Ω–µ –¥–ª—è –±–∏–∑–Ω–µ—Å-–æ—à–∏–±–æ–∫</p>
<p>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è:</p>
<ul>
    <li>–ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã—Ö –±–∞–≥–æ–≤</li>
    <li>–Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π</li>
    <li>–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</li>
</ul>
<pre><code class="language-go">panic("unreachable")</code></pre>
<p>–í –≤–µ–±-—Å–µ—Ä–≤–∏—Å–µ:</p>
<ul>
    <li>panic –ª–æ–≤–∏—Ç—Å—è middleware</li>
    <li>–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ 500</li>
</ul>

{{ end }}