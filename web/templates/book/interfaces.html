{{ define "book.interfaces" }}
<h1>Interfaces</h1>
<p><b>–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å</b> ‚Äî <b>—ç—Ç–æ –Ω–∞–±–æ—Ä –º–µ—Ç–æ–¥–æ–≤</b>, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Å—ã–≤–∞–µ—Ç <i>–ø–æ–≤–µ–¥–µ–Ω–∏–µ</i>, –∞ –Ω–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö.</p>
<pre><code class="language-go">type Reader interface {
	Read(p []byte) (n int, err error)
}</code></pre>
<p>üëâ –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≥–æ–≤–æ—Ä–∏—Ç:</p>
<blockquote class="note">¬´–ú–Ω–µ –Ω—É–∂–µ–Ω –ª—é–±–æ–π —Ç–∏–ø, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –µ—Å—Ç—å –º–µ—Ç–æ–¥ Read —Å —Ç–∞–∫–æ–π —Å–∏–≥–Ω–∞—Ç—É—Ä–æ–π¬ª</blockquote>
<hr>
<h2>–ù–µ—è–≤–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è</h2>
<p>–í Go <b>–Ω–µ –Ω—É–∂–Ω–æ —è–≤–Ω–æ –æ–±—ä—è–≤–ª—è—Ç—å</b>, —á—Ç–æ —Ç–∏–ø —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.</p>
<pre><code class="language-go">type File struct {}

func (f File) Read(p []byte) (int, error) {
	return 0, nil
}</code></pre>
<p><code>File</code> <b>—É–∂–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç</b> <code>Reader</code>.<br>
    –ù–∏–∫–∞–∫–æ–≥–æ <code>implements</code>, <code>extends</code> ‚Äî <b>—É—Ç–∫–∞-–ø–æ–¥—Ö–æ–¥</b> ü¶Ü:</p>
<blockquote class="note">If it walks like a duck and quacks like a duck‚Ä¶</blockquote>
<hr>
<h2>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</h2>
<pre><code class="language-go">func Process(r Reader) {
	buf := make([]byte, 10)
	r.Read(buf)
}</code></pre>
<pre><code class="language-go">var f File
Process(f) // OK</code></pre>
<p>üìå <b>–§—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –∞ –Ω–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–ø—ã</b> ‚Äî —ç—Ç–æ –æ—Å–Ω–æ–≤–∞ –≥–∏–±–∫–æ—Å—Ç–∏ –≤ Go.</p>
<hr>
<h2>–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å ‚â† –∫–ª–∞—Å—Å</h2>
<p>–í Go:</p>
<ul>
    <li>‚ùå –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã—Ö</li>
    <li>‚ùå –Ω–µ—Ç –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è</li>
    <li>‚úÖ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ</li>
</ul>
<pre><code class="language-go">type UserService interface {
	CreateUser(name string) error
}</code></pre>
<p>–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:</p>
<pre><code class="language-go">type userService struct {
	repo UserRepo
}

func (s *userService) CreateUser(name string) error {
	return s.repo.Save(name)
}</code></pre>
<p>üëâ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π –∏–µ—Ä–∞—Ä—Ö–∏–∏ –Ω–µ—Ç ‚Äî <b>–∫–æ–º–ø–æ–∑–∏—Ü–∏—è</b> > <b>–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</b></p>
<hr>

<h2>–ü—É—Å—Ç–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (interface{} / any)</h2>
<pre><code class="language-go">var v interface{}
v = 10
v = "hello"</code></pre>
<p>–í Go 1.18+:</p>
<pre><code class="language-go">var v any</code></pre>
<p>‚ö†Ô∏è –ú–∏–Ω—É—Å: —Ç–µ—Ä—è–µ—Ç—Å—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</p>
<p>–ß—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ:</p>
<pre><code class="language-go">s := v.(string)        // panic –µ—Å–ª–∏ –Ω–µ string
s, ok := v.(string)   // –±–µ–∑–æ–ø–∞—Å–Ω–æ</code></pre>
<hr>
<h2>Type assertion –∏ type switch</h2>
<h3>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞</h3>
<pre><code class="language-go">func Print(v any) {
	switch t := v.(type) {
	case int:
		fmt.Println("int:", t)
	case string:
		fmt.Println("string:", t)
	default:
		fmt.Println("unknown")
	}
}</code></pre>
<p>üìå –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å:</p>
<ul>
    <li>error</li>
    <li>JSON</li>
    <li>middleware</li>
    <li>generic API</li>
</ul>
<hr>
<h2>–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ nil</h2>
<pre><code class="language-go">var err *MyError = nil
var e error = err

fmt.Println(e == nil) // false üò±</code></pre>
<p>–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å = (<b>type, value</b>)</p>
<pre><code class="language-go">(type = *MyError, value = nil)</code></pre>
<p><b>üìå –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–∞–≤–µ–Ω nil —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏ type, –∏ value ‚Äî nil</b></p>
<hr>
<h2>–ú–∞–ª–µ–Ω—å–∫–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã ‚Äî –∏–¥–∏–æ–º–∞—Ç–∏—á–Ω–æ</h2>
<p>Go –ª—é–±–∏—Ç <b>–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã</b>:</p>
<pre><code class="language-go">type Stringer interface {
	String() string
}</code></pre>
<p>–í —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ:</p>
<ul>
    <li>io.Reader</li>
    <li>io.Writer</li>
    <li>context.Context</li>
    <li>http.Handler</li>
</ul>
<p>üìå –ü—Ä–∏–Ω—Ü–∏–ø:</p>
<blockquote class="note">Accept interfaces, return structs</blockquote>
<hr>
<h2>–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã vs Generics</h2>
<table>
    <thead>
    <tr>
        <th>–ö–æ–≥–¥–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</th>
        <th>–ö–æ–≥–¥–∞ generics</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td>–†–∞–∑–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ</td>
        <td>–û–¥–∏–Ω–∞–∫–æ–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ</td>
    </tr>
    <tr>
        <td>–ü–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º</td>
        <td>–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</td>
    </tr>
    <tr>
        <td>API / –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</td>
        <td>–ê–ª–≥–æ—Ä–∏—Ç–º—ã / –∫–æ–ª–ª–µ–∫—Ü–∏–∏</td>
    </tr>
    <tr>
        <td>Mock / DI</td>
        <td>–£—Ç–∏–ª–∏—Ç—ã</td>
    </tr>
    </tbody>
</table>
<p>üìå –û–Ω–∏ <b>–Ω–µ –∫–æ–Ω–∫—É—Ä–∏—Ä—É—é—Ç</b>, –∞ –¥–æ–ø–æ–ª–Ω—è—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞.</p>
<hr>
<h2>–í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ</h2>
<p>–í Go –º–æ–∂–Ω–æ <b>–≤—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —Ç–∏–ø—ã –±–µ–∑ –∏–º–µ–Ω–∏ –ø–æ–ª—è</b>:</p>
<pre><code class="language-go">type A struct {
	ID int
}

type B struct {
	A
	Name string
}</code></pre>
<p>–¢–µ–ø–µ—Ä—å:</p>
<pre><code class="language-go">b := B{}
b.ID    // ‚Üê –ø—Ä–∏—à–ª–æ –∏–∑ A
b.A.ID  // —Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</code></pre>
<p>üëâ –≠—Ç–æ <b>–∫–æ–º–ø–æ–∑–∏—Ü–∏—è —Å –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ–º –º–µ—Ç–æ–¥–æ–≤ –∏ –ø–æ–ª–µ–π</b>.</p>
<h3>–í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä + –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã</h3>
<p>–ï—Å–ª–∏ —É –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –µ—Å—Ç—å –º–µ—Ç–æ–¥—ã ‚Äî –æ–Ω–∏ <b>–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–¥–≤–∏–≥–∞—é—Ç—Å—è –Ω–∞—Ä—É–∂—É</b>.</p>
<pre><code class="language-go">type Logger struct{}

func (l Logger) Log(msg string) {}

type Service struct {
	Logger
}</code></pre>
<p>–¢–µ–ø–µ—Ä—å <code>Service</code> –∏–º–µ–µ—Ç –º–µ—Ç–æ–¥ <code>Log</code>:</p>
<pre><code class="language-go">var s Service
s.Log("hello")</code></pre>
<p>üìå <b>Service —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ª—é–±–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</b>, –∫–æ—Ç–æ—Ä—ã–π —Ç—Ä–µ–±—É–µ—Ç <code>Log(string)</code>.</p>
<h3>–í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã</h3>
<p>–≠—Ç–æ —Å—É–ø–µ—Ä–≤–∞–∂–Ω–æ üî•</p>
<pre><code class="language-go">type Reader interface {
	Read(p []byte) (int, error)
}

type Closer interface {
	Close() error
}

type ReadCloser interface {
	Reader
	Closer
}</code></pre>
<p>–≠–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ:</p>
<pre><code class="language-go">type ReadCloser interface {
	Read([]byte) (int, error)
	Close() error
}</code></pre>
<p>üëâ <b>ReadCloser = –∫–æ–º–ø–æ–∑–∏—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤</b></p>
<h3>–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–∞–≤–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</h3>
<pre><code class="language-go">type File struct{}

func (f File) Read(p []byte) (int, error) { return 0, nil }
func (f File) Close() error               { return nil }

var rc ReadCloser = File{} // OK</code></pre>
<p>üìå –¢–∏–ø <b>–Ω–µ –∑–Ω–∞–µ—Ç</b>, —á—Ç–æ –æ–Ω —Ä–µ–∞–ª–∏–∑—É–µ—Ç <code>ReadCloser</code>.</p>
<h3>–í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É</h3>
<p>–û—á–µ–Ω—å –º–æ—â–Ω—ã–π, –Ω–æ —Ç–æ–Ω–∫–∏–π –º–æ–º–µ–Ω—Ç ‚ö†Ô∏è</p>
<pre><code class="language-go">type Service struct {
	Reader
}</code></pre>
<p>–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç?</p>
<ul>
    <li>Service <b>–ù–ï —Ä–µ–∞–ª–∏–∑—É–µ—Ç</b> <code>Reader</code></li>
    <li>Service <b>–î–ï–õ–ï–ì–ò–†–£–ï–¢</b> –≤—ã–∑–æ–≤—ã –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–º—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É</li>
</ul>
<pre><code class="language-go">s := Service{
	Reader: someReader,
}

s.Read(buf) // –≤—ã–∑—ã–≤–∞–µ—Ç someReader.Read</code></pre>
<p>–ù–æ –µ—Å–ª–∏ <code>Reader == nil</code> ‚Üí panic –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –º–µ—Ç–æ–¥–∞.</p>
<h3>–ß–∞—Å—Ç–∞—è –ª–æ–≤—É—à–∫–∞ ‚ùå</h3>
<pre><code class="language-go">type Service struct {
	io.Reader
}

var s Service
s.Read(buf) // üí• panic: nil pointer</code></pre>
<p>–ü–æ—á–µ–º—É?</p>
<ul>
    <li>–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å <code>io.Reader</code> = nil</li>
    <li>–ú–µ—Ç–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ nil-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</li>
</ul>
<p>üìå –ù—É–∂–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å:</p>
<pre><code class="language-go">s := Service{Reader: os.Stdin}</code></pre>
<h3>Embedding ‚â† –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</h3>
<table>
    <thead>
    <tr>
        <th>–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ</th>
        <th>Embedding</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td>IS-A</td>
        <td>HAS-A</td>
    </tr>
    <tr>
        <td>–ñ—ë—Å—Ç–∫–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è</td>
        <td>–ì–∏–±–∫–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è</td>
    </tr>
    <tr>
        <td>–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã</td>
        <td>–ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤</td>
    </tr>
    <tr>
        <td>–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</td>
        <td>–¢–µ–Ω–µ–≤–æ–µ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ</td>
    </tr>
    </tbody>
</table>
<pre><code class="language-go">type A struct{}
func (A) Foo() {}

type B struct {
	A
}

func (B) Foo() {} // –Ω–µ override, –∞ shadowing</code></pre>
<h3>–ö–æ–≥–¥–∞ embedding ‚Äî —ç—Ç–æ —Ö–æ—Ä–æ—à–æ, –∞ –∫–æ–≥–¥–∞ –Ω–µ—Ç</h3>
<p>‚úÖ –•–æ—Ä–æ—à–æ</p>
<ul>
    <li>–î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã</li>
    <li>Middleware</li>
    <li>–ê–¥–∞–ø—Ç–µ—Ä—ã</li>
    <li>–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è</li>
</ul>
<p>‚ùå –ü–ª–æ—Ö–æ</p>
<ul>
    <li>–î–ª—è ‚Äú–ø—Ä–æ—Å—Ç–æ —É–¥–æ–±—Å—Ç–≤–∞‚Äù</li>
    <li>–ï—Å–ª–∏ —Å–∫—Ä—ã–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏</li>
    <li>–ï—Å–ª–∏ —É—Å–ª–æ–∂–Ω—è–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é</li>
</ul>



<hr>



<h2>–ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –Ω–æ–≤–∏—á–∫–æ–≤</h2>
<p>
    ‚ùå –î–µ–ª–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã ¬´–Ω–∞ –±—É–¥—É—â–µ–µ¬ª<br>
    ‚ùå –î–µ–ª–∞—Ç—å –±–æ–ª—å—à–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã<br>
    ‚ùå –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞<br>
    ‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å interface{} –≤–º–µ—Å—Ç–æ generics<br>
    ‚ùå –°—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å nil –Ω–µ –ø–æ–Ω–∏–º–∞—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–µ–π<br>
</p>
<hr>
<h2>–ó–æ–ª–æ—Ç—ã–µ –ø—Ä–∞–≤–∏–ª–∞</h2>
<ul>
    <li>–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –æ–±—ä—è–≤–ª—è–π <b>—Ç–∞–º, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å</b></li>
    <li>–î–µ–ª–∞–π –∏—Ö <b>–º–∞–ª–µ–Ω—å–∫–∏–º–∏</b></li>
    <li>–ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è <b>–≥—Ä–∞–Ω–∏—Ü —Å–∏—Å—Ç–µ–º—ã</b></li>
    <li>–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–π <b>–∫–æ–º–ø–æ–∑–∏—Ü–∏—é</b></li>
    <li>–ü–æ–Ω–∏–º–∞–π, —á—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ‚Äî —ç—Ç–æ <code>(type, value)</code></li>
</ul>





{{ end }}